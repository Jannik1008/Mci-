<html>
    <head>
        <title>Bin√§rer Stimulus</title>
        <style>
            body {
                font-family: sans-serif;
            }
            #stimulus {
                height: 40px;
            }
        </style>
    </head>

    <body>
        <h1 id="title">Decision Reaction Time</h1>
        <h2 id="instruction">Press space to start!</h2>
        <div id="stimulus"></div>
        <p id="time"></p>
        <p id="count"></p>
        <p id="mean"></p>
        <p id="sd"></p>

    </body>

    <script>
        let experimentActive = false;
        let stimulusIsVisible = false;
        let stimulusTimestamp;
        let testStimulusTimeout;
        let times = [];

        let timeElement = document.getElementById('time');  
        let countElement = document.getElementById('count');
        let meanElement = document.getElementById('mean');
        let stdDevElement = document.getElementById('sd');
        let instructionElement = document.getElementById('instruction');
        let stimulusElement = document.getElementById('stimulus');
        
        function getMean(data) {
            let sum = 0;
            for (let value of data) sum += value;
            return sum / data.length;
        }

        
        function showStimulus(){
            createCanvas(100, 100);
            background(220); 
            fill(setStimulusColor()); 
  
            // A triangle at (100, 250), (250, 170) and (330, 300)   
            triangle(100, 250, 250, 170, 330, 300);
            stimulusIsVisible = true;
            stimulusTimestamp = Date.now();
        }
        function clearResults() {
            timeElement.textContent = '';
            countElement.textContent = '';
            meanElement.textContent = '';
            stdDevElement.textContent = '';
        }

        function getStandardDeviation(data) {
            let mean = getMean(data);
            let squareSum = 0;
            for (let value of data) squareSum += (value - mean) ** 2;
            return Math.sqrt(squareSum / data.length);
        }

        function showResults() {
            countElement.textContent = `Count: ${times.length}`;
            meanElement.textContent = `Mean: ${getMean(times).toFixed(2)} ms`;
            stdDevElement.textContent = `Standard Deviation: ${getStandardDeviation(times).toFixed(2)} ms`;
        }

        function setStimulusColor() {
            randomNumber = Math.random(2)
            if(randomNumber < 1){
                stimulusElement.style.backgroundColor = 'orange';
            }
            else{
                stimulusElement.style.backgroundColor = 'purple';
            }
            
        }

        function startTestTrial() {
            
            stimulusIsVisible = false;

            let delay = Math.random() * 4000 + 2000;
            testStimulusTimeout = setTimeout(showStimulus, delay);
        }

        function recordStimulusReactionTime() {
            let reactionTime = Date.now() - stimulusTimestamp;
            times.push(reactionTime);
            timeElement.textContent = `Reaction time: ${reactionTime} ms`;
            showResults();
        }

        function startExperiment(){
        clearResults();
        instructionElement.textContent = 'Press space when the stimulus appears!';
        times = [];
        experimentActive = true;
        startTestTrial();
        }

        function stopExperiment(){
        clearTimeout(testStimulusTimeout);
        stimulusIsVisible = false;
        experimentActive = false;
        instructionElement.textContent = 'Press space to start!';
        showResults();
        }

        window.addEventListener('keydown',(event) => {
            if (event.key === ' ') {
                if (!experimentActive) {
                    startExperiment();
                    return;
                }
                if (stimulusIsVisible) {
                    recordStimulusReactionTime();
                    startTestTrial();
                    document.getElementsById("instruction").style.display('Press a to end ')
                }
            }
            else if (event.key ==='a') {
                if (experimentActive) {
                    stopExperiment();
                }
                else if (event.key ==='b') {
                    //...
                }
            
            }
        });

    </script>
</html>